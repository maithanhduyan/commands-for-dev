<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Design Sokoban Map</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
        background: #f0f0f0;
      }
      h1 {
        margin-bottom: 10px;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(20, 20px);
        grid-template-rows: repeat(20, 20px);
        gap: 2px;
        margin-bottom: 20px;
      }
      .cell {
        width: 20px;
        height: 20px;
        border: 1px solid #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        cursor: pointer;
        user-select: none;
      }
      /* Các trạng thái cho cell */
      .empty {
        background-color: #fff;
      }
      .wall {
        background-color: #555;
        color: #fff;
      }
      .block {
        background-color: #ffbb5b;
      }
      .player {
        background-color: #8bc34a;
      }
      .goal {
        background-color: #fdd835;
      }
      textarea {
        width: 100%;
        height: 200px;
        resize: none;
      }
    </style>
  </head>
  <body>
    <h1>Thiết Kế Map Sokoban</h1>
    <p>Click vào ô để chuyển qua các trạng thái theo thứ tự: <br>
        Tường(#) → Thùng gỗ($) → Người chơi(@) → Mục tiêu(.) → Trống</p>
    <div class="grid" id="grid"></div>
    <button id="exportBtn">Xuất Map</button>
    <h2>Kết Quả Map:</h2>
    <textarea id="output" readonly></textarea>

    <script>
      // Các trạng thái và ký hiệu tương ứng
      const states = ["empty", "wall", "block", "player", "goal"];
      const symbols = {
        empty: " ",
        wall: "#",
        block: "$",
        player: "@",
        goal: "."
      };

      const gridSize = 20;
      const gridElement = document.getElementById("grid");
      const outputElement = document.getElementById("output");
      // Mảng lưu trữ các ô (cells)
      let gridCells = [];

      // Tạo lưới 8x8
      for (let r = 0; r < gridSize; r++) {
        gridCells[r] = [];
        for (let c = 0; c < gridSize; c++) {
          const cell = document.createElement("div");
          cell.classList.add("cell", "empty"); // trạng thái ban đầu là empty
          cell.dataset.stateIndex = "0"; // index trong mảng states (0 là empty)
          cell.dataset.row = r;
          cell.dataset.col = c;

          cell.addEventListener("click", function () {
            let index = parseInt(cell.dataset.stateIndex);
            // Tăng index, sau trạng thái cuối quay lại trạng thái đầu tiên (empty)
            index = (index + 1) % states.length;
            cell.dataset.stateIndex = index;
            // Xóa tất cả lớp trạng thái và thêm lớp mới
            states.forEach((s) => cell.classList.remove(s));
            cell.classList.add(states[index]);
            // Hiển thị ký hiệu nếu khác " " (ô trống)
            cell.textContent = symbols[states[index]] === " " ? "" : symbols[states[index]];
          });

          gridElement.appendChild(cell);
          gridCells[r][c] = cell;
        }
      }

      // Xuất map ra dạng text
      document.getElementById("exportBtn").addEventListener("click", function () {
        let output = "";
        for (let r = 0; r < gridSize; r++) {
          let line = "";
          for (let c = 0; c < gridSize; c++) {
            const stateIndex = parseInt(gridCells[r][c].dataset.stateIndex);
            const stateName = states[stateIndex];
            line += symbols[stateName];
          }
          output += line + "\n";
        }
        outputElement.value = output;
      });
    </script>
  </body>
</html>
