var d=Object.defineProperty;var h=(a,e,t)=>e in a?d(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var i=(a,e,t)=>h(a,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();class p{constructor(e){i(this,"snakeBody");i(this,"color");this.snakeBody=[],this.color=e}draw(e,t){e.fillStyle=this.color;for(const s of this.snakeBody)e.fillRect(s.x,s.y,t,t)}updateSnakeBody(e){this.snakeBody=e}}class l{constructor(e,t,s="#FF0000"){i(this,"x");i(this,"y");i(this,"color");i(this,"angle");this.x=e,this.y=t,this.color=s,this.angle=0}draw(e,t){e.save(),e.translate(this.x,this.y),e.rotate(this.angle),e.fillStyle=this.color,e.fillRect(-t/2,-t/2,t,t),e.restore(),this.updateRotation()}updateRotation(){this.angle+=1,this.angle>=360&&(this.angle=0)}}class r{static log(e){const t=document.getElementById("console");if(t){const s=document.createElement("p");for(s.style.wordWrap="break-word",s.innerHTML=e,t.appendChild(s);t.childNodes.length>25;)t.removeChild(t.firstChild);t.scrollTop=t.scrollHeight}}}const u="./assets/sounds/explosion.wav",f="./assets/sounds/powerUp.wav";class g{constructor(){i(this,"fps");i(this,"socket");i(this,"interval");i(this,"direction");i(this,"gridSize");i(this,"score");i(this,"highestScore");i(this,"snakes");i(this,"foods");i(this,"context");i(this,"canvas");this.fps=30,this.socket=null,this.interval=null,this.direction="none",this.gridSize=10,this.score=0,this.highestScore=0,this.snakes={},this.foods=[],this.context=null,this.canvas=null}initialize(){if(this.canvas=document.getElementById("playground"),!this.canvas.getContext){r.log("Error: 2D canvas not supported by this browser.");return}this.context=this.canvas.getContext("2d"),window.addEventListener("keydown",o=>{const n=o.keyCode;if(n>=37&&n<=40)switch(n){case 37:this.direction!=="east"&&this.setDirection("west");break;case 38:this.direction!=="south"&&this.setDirection("north");break;case 39:this.direction!=="west"&&this.setDirection("east");break;case 40:this.direction!=="north"&&this.setDirection("south");break}},!1);const e=window.location.protocol==="http:"?"ws://":"wss://";this.connect(`${e}localhost:8080/examples/websocket/snake`)}setDirection(e){var t;this.direction=e,(t=this.socket)==null||t.send(e),r.log(`Sent: Direction ${e}`)}startGameLoop(){const e=()=>{this.draw(),requestAnimationFrame(e)};requestAnimationFrame(e)}stopGameLoop(){this.interval&&clearInterval(this.interval)}draw(){if(!(!this.context||!this.canvas)){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.foods.forEach(e=>e.draw(this.context,this.gridSize));for(const e in this.snakes)this.snakes[e].draw(this.context,this.gridSize)}}addSnake(e,t){const s=new p(t);this.snakes[e]=s}updateSnake(e,t){this.snakes[e]&&this.snakes[e].updateSnakeBody(t)}removeSnake(e){delete this.snakes[e]}updateScore(e){this.score=e;const t=document.getElementById("score");if(t&&(t.innerText=e.toString()),e>this.highestScore){this.highestScore=e;const s=document.getElementById("highestScore");s&&(s.innerText=this.highestScore.toString())}}connect(e){this.socket=new WebSocket(e),this.socket.onopen=()=>{r.log("Info: WebSocket connection opened."),r.log("Info: Press an arrow key to begin."),this.startGameLoop(),setInterval(()=>{var t;(t=this.socket)==null||t.send("ping")},5e3)},this.socket.onclose=()=>{r.log("Info: WebSocket closed."),this.stopGameLoop()},this.socket.onmessage=t=>{const s=JSON.parse(t.data);switch(s.type){case"update":s.data.forEach(o=>{this.updateSnake(o.id,o.body)}),s.foods&&(this.foods=s.foods.map(o=>new l(o.x,o.y)));break;case"foods":this.foods=s.data.map(o=>new l(o.x,o.y));break;case"eat":r.log("Info: You ate food! Snake length increased."),this.playPowerUpSound(),s.score!==void 0&&this.updateScore(s.score);break;case"join":s.data.forEach(o=>{this.addSnake(o.id,o.color)}),s.score!==void 0&&this.updateScore(s.score);break;case"leave":s.id&&this.removeSnake(s.id);break;case"dead":r.log("Info: Your snake is dead, bad luck!"),this.direction="none",this.playExplosionSound();break}}}playPowerUpSound(){const e=new Audio(f);e.volume=.5,e.play().catch(t=>{r.log("Error: Unable to play sound. "+t)})}playExplosionSound(){new Audio(u).play().catch(t=>{r.log("Error: Unable to play sound. "+t)})}}document.addEventListener("DOMContentLoaded",()=>{var t;const a=document.getElementsByClassName("noscript");for(;a.length>0;)(t=a[0].parentNode)==null||t.removeChild(a[0]);new g().initialize(),r.log("Game Ready!")},!1);
